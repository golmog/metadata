{% extends "base.html" %}
{% block content %}

{{ macros.m_button_group([['globalSettingSaveBtn', '설정 저장']])}}
{{ macros.m_row_start('5') }}
{{ macros.m_row_end() }}

{{ macros.m_hr_black() }}


<form id='setting' name='setting'>
<div class="tab-content" id="nav-tabContent">

{{ macros.setting_input_text_and_buttons('jav_uncensored_1pondo_test_code', '1pondo 테스트 품번', [['jav_uncensored_1pondo_test_btn', '테스트'], ['jav_uncensored_1pondo_nfo_download_btn', 'NFO'], ['jav_uncensored_1pondo_yaml_download_btn', 'YAML'], ['jav_uncensored_1pondo_pl_download_btn', '포스터(원본)'], ['jav_uncensored_1pondo_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_1pondo_test_code'], desc=None) }}
{{ macros.setting_checkbox('jav_uncensored_1pondo_use_proxy', '1pondo Proxy 사용', value=arg['jav_uncensored_1pondo_use_proxy'], desc=None) }}
<div id="jav_uncensored_1pondo_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_1pondo_proxy_url', '1pondo Proxy URL', value=arg['jav_uncensored_1pondo_proxy_url']) }}
</div>

{{ macros.m_hr() }}

{{ macros.setting_input_text_and_buttons('jav_uncensored_10musume_test_code', '10musume 테스트 품번', [['jav_uncensored_10musume_test_btn', '테스트'], ['jav_uncensored_10musume_nfo_download_btn', 'NFO'], ['jav_uncensored_10musume_yaml_download_btn', 'YAML'], ['jav_uncensored_10musume_pl_download_btn', '포스터(원본)'], ['jav_uncensored_10musume_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_10musume_test_code'], desc=None) }}
{{ macros.setting_checkbox('jav_uncensored_10musume_use_proxy', '10musume Proxy 사용', value=arg['jav_uncensored_10musume_use_proxy'], desc=None) }}
<div id="jav_uncensored_10musume_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_10musume_proxy_url', '10musume Proxy URL', value=arg['jav_uncensored_10musume_proxy_url']) }}
</div>

{{ macros.m_hr() }}

{{ macros.setting_input_text_and_buttons('jav_uncensored_paco_test_code', 'Paco 테스트 품번', [['jav_uncensored_paco_test_btn', '테스트'], ['jav_uncensored_paco_nfo_download_btn', 'NFO'], ['jav_uncensored_paco_yaml_download_btn', 'YAML'], ['jav_uncensored_paco_pl_download_btn', '포스터(원본)'], ['jav_uncensored_paco_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_paco_test_code'], desc=None) }}
{{ macros.setting_checkbox('jav_uncensored_paco_use_proxy', 'Paco Proxy 사용', value=arg['jav_uncensored_paco_use_proxy'], desc=None) }}
<div id="jav_uncensored_paco_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_paco_proxy_url', 'Paco Proxy URL', value=arg['jav_uncensored_paco_proxy_url']) }}
</div>

{{ macros.m_hr() }}

{{ macros.setting_input_text_and_buttons('jav_uncensored_heyzo_test_code', 'heyzo 테스트 품번', [['jav_uncensored_heyzo_test_btn', '테스트'], ['jav_uncensored_heyzo_nfo_download_btn', 'NFO'], ['jav_uncensored_heyzo_yaml_download_btn', 'YAML'], ['jav_uncensored_heyzo_pl_download_btn', '포스터(원본)'], ['jav_uncensored_heyzo_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_heyzo_test_code'], desc=None) }}
{{ macros.setting_checkbox('jav_uncensored_heyzo_use_proxy', 'heyzo Proxy 사용', value=arg['jav_uncensored_heyzo_use_proxy'], desc=None) }}
<div id="jav_uncensored_heyzo_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_heyzo_proxy_url', 'heyzo Proxy URL', value=arg['jav_uncensored_heyzo_proxy_url']) }}
</div>

{{ macros.m_hr() }}

{{ macros.setting_input_text_and_buttons('jav_uncensored_carib_test_code', 'carib 테스트 품번', [['jav_uncensored_carib_test_btn', '테스트'], ['jav_uncensored_carib_nfo_download_btn', 'NFO'], ['jav_uncensored_carib_yaml_download_btn', 'YAML'], ['jav_uncensored_carib_pl_download_btn', '포스터(원본)'], ['jav_uncensored_carib_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_carib_test_code'], desc=None) }}
{{ macros.setting_checkbox('jav_uncensored_carib_use_proxy', 'carib Proxy 사용', value=arg['jav_uncensored_carib_use_proxy'], desc=None) }}
<div id="jav_uncensored_carib_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_carib_proxy_url', 'carib Proxy URL', value=arg['jav_uncensored_carib_proxy_url']) }}
</div>

{{ macros.m_hr() }}

{{ macros.setting_input_text_and_buttons('jav_uncensored_fc2com_test_code', 'fc2 테스트 품번', [['jav_uncensored_fc2com_test_btn', '테스트'], ['jav_uncensored_fc2com_nfo_download_btn', 'NFO'], ['jav_uncensored_fc2com_yaml_download_btn', 'YAML'], ['jav_uncensored_fc2com_pl_download_btn', '포스터(원본)'], ['jav_uncensored_fc2com_p_download_btn', '포스터(세로)']], value=arg['jav_uncensored_fc2com_test_code'], desc=None) }}
{{ macros.info_text('Selenium 설정', 'fc2com Selenium', desc=['Selenium 설정은 Censored 플러그인의 전역 설정을 따릅니다.', '메타데이터 > JAV Censored > 설정 탭에서 Selenium URL을 설정하세요.']) }}
{{ macros.setting_checkbox('jav_uncensored_fc2com_use_proxy', 'fc2com Proxy 사용', value=arg['jav_uncensored_fc2com_use_proxy'], desc=None) }}
<div id="jav_uncensored_fc2com_use_proxy_div" class="collapse">
{{ macros.setting_input_text('jav_uncensored_fc2com_proxy_url', 'fc2com Proxy URL', value=arg['jav_uncensored_fc2com_proxy_url']) }}
</div>

</div><!--tab-content-->
</form>


<script type="text/javascript">
$(document).ready(function(){
  const sites = ['1pondo', '10musume', 'paco', 'heyzo', 'carib', 'fc2com'];
  sites.forEach(function(site) {
      use_collapse("jav_uncensored_" + site + "_use_proxy");

      $('#jav_uncensored_' + site + '_use_proxy').change(function() {
          use_collapse('jav_uncensored_' + site + '_use_proxy');
      });
  });
});

$("body").on('click', 'button[id^="jav_uncensored_"][id$="_btn"]', function(e){
    e.preventDefault();
    const btnId = $(this).attr('id');
    const parts = btnId.split('_'); 
    
    const site = parts[2];
    
    const actionParts = parts.slice(3, -1); 
    const action = actionParts.join('_');

    const codeInputId = "jav_uncensored_" + site + "_test_code";
    const code = document.getElementById(codeInputId).value;

    if (action === 'test') {
        if (!code || !code.trim()) { notify('테스트 코드 입력', 'warning'); return; }
        globalSendCommand('test', site, code);
    } 
    else if (action === 'nfo_download') {
        window.location.href = '/metadata/normal/jav_uncensored/nfo_download?call=' + site + '&code=' + code;
    }
    else if (action === 'yaml_download') {
        window.location.href = '/metadata/normal/jav_uncensored/yaml_download?call=' + site + '&code=' + code;
    }
    else if (action === 'pl_download') {
        window.location.href = '/metadata/normal/jav_uncensored/image_download?call=' + site + '&type=pl&code=' + code;
    }
    else if (action === 'p_download') {
        window.location.href = '/metadata/normal/jav_uncensored/image_download?call=' + site + '&type=p&code=' + code;
    }
});

$('input[id$="_test_code"]').on('keypress', function(e) {
  if (e.which === 13) {
    e.preventDefault();
    var siteName = $(this).attr('id').split('_')[2];
    var buttonId = '#jav_uncensored_' + siteName + '_test_btn';
    $(buttonId).click();
  }
});

</script>    
{% endblock %}